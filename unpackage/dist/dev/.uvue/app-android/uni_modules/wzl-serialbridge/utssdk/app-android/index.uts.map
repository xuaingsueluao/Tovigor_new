{"version":3,"file":"index.uts","sourceRoot":"","sources":["uni_modules/wzl-serialbridge/utssdk/app-android/index.uts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * wzl-serialbridge Android 平台实现\r\n * 基于 Kotlin SerialPort AAR 封装\r\n */\r\n\r\n// 探针函数 - 用于验证导出机制\r\nexport function __probe(): number {\r\n  return 42\r\n}\r\n\r\n// 导入接口定义(仅用于类型约束)\r\nimport type {\r\n  OpenOptions,\r\n  OpenResult,\r\n  WriteOptions,\r\n  WriteResult,\r\n  ReadOptions,\r\n  ReadResult,\r\n  CloseOptions,\r\n  CloseResult,\r\n  ListDevicesOptions,\r\n  ListDevicesResult\r\n} from '../../interface.uts'\r\n\r\n// 导入错误类\r\nimport { SerialErrorImpl } from '../../unierror.uts'\r\n\r\n// 导入 Kotlin AAR 中的类 - 使用全限定类名 + 默认导入\r\nimport SerialPort from 'com.example.serialbridge.SerialPort'\r\nimport SerialConfig from 'com.example.serialbridge.SerialConfig'\r\nimport DataBits from 'com.example.serialbridge.DataBits'\r\nimport StopBits from 'com.example.serialbridge.StopBits'\r\nimport Parity from 'com.example.serialbridge.Parity'\r\nimport File from 'java.io.File'\r\nimport IOException from 'java.io.IOException'\r\nimport Base64 from 'android.util.Base64'\r\n\r\n// ==================== 全局状态管理 ====================\r\n\r\n/**\r\n * 串口实例池，key 为句柄 ID\r\n */\r\nconst serialPorts: Map<Int, SerialPort> = new Map()\r\n\r\n/**\r\n * 句柄 ID 计数器\r\n */\r\nlet portIdCounter: Int = 1\r\n\r\n/**\r\n * 生成新的串口句柄 ID\r\n */\r\nfunction generatePortId(): Int {\r\n  return portIdCounter++\r\n}\r\n\r\n// ==================== 工具函数 ====================\r\n\r\n/**\r\n * 解析校验位字符串为枚举\r\n */\r\nfunction parseParity(parity: string): Parity {\r\n  switch (parity.toLowerCase()) {\r\n    case 'odd':\r\n      return Parity.ODD\r\n    case 'even':\r\n      return Parity.EVEN\r\n    default:\r\n      return Parity.NONE\r\n  }\r\n}\r\n\r\n/**\r\n * HEX 字符串转字节数组\r\n */\r\nfunction hexToBytes(hex: string): ByteArray {\r\n  const cleanHex = hex.replace(/\\s+/g, '').replace(/^0x/i, '')\r\n  const len: Int = cleanHex.length.toInt()\r\n  const bytes = new ByteArray((len / 2).toInt())\r\n  \r\n  for (let i = 0; i < len; i += 2) {\r\n    const start: Int = i.toInt()\r\n    const end: Int = (i + 2).toInt()\r\n    const byte = parseInt(cleanHex.substring(start, end), 16)\r\n    bytes[(i / 2).toInt()] = byte.toByte()\r\n  }\r\n  \r\n  return bytes\r\n}\r\n\r\n/**\r\n * 字节数组转 HEX 字符串\r\n */\r\nfunction bytesToHex(bytes: ByteArray, length: number): string {\r\n  const hexChars = \"0123456789ABCDEF\"\r\n  const n: Int = length.toInt()\r\n  let result = \"\"\r\n  \r\n  for (let i = 0; i < n; i++) {\r\n    const idx: Int = i.toInt()\r\n    const v = (bytes[idx].toInt() & 0xFF)\r\n    result += hexChars[(v >> 4)]\r\n    result += hexChars[(v & 0x0F)]\r\n  }\r\n  \r\n  return result\r\n}\r\n\r\n/**\r\n * Base64 字符串转字节数组\r\n */\r\nfunction base64ToBytes(base64: string): ByteArray {\r\n  return Base64.decode(base64, Base64.DEFAULT)\r\n}\r\n\r\n/**\r\n * 字节数组转 Base64 字符串\r\n */\r\nfunction bytesToBase64(bytes: ByteArray, length: number): string {\r\n  const trimmedBytes = bytes.copyOf(length.toInt())\r\n  return Base64.encodeToString(trimmedBytes, Base64.DEFAULT)\r\n}\r\n\r\n// ==================== API 实现 ====================\r\n\r\n/**\r\n * 打开串口\r\n */\r\nexport function openSerial(options: OpenOptions) {\r\n  try {\r\n    // 参数校验\r\n    if (options.path == null || options.path.length == 0) {\r\n      const err = new SerialErrorImpl(10006)\r\n      err.errMsg = \"设备路径不能为空\"\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 构建配置对象\r\n    const config = options.config ?? {}\r\n    const baudRate = config.baudRate ?? 115200\r\n    const dataBitsValue = config.dataBits ?? 8\r\n    const stopBitsValue = config.stopBits ?? 1\r\n    const parityValue = config.parity ?? 'none'\r\n\r\n    // 转换为 Kotlin 枚举\r\n    let dataBits: DataBits\r\n    if (dataBitsValue == 5) {\r\n      dataBits = DataBits.DATA_BITS_5\r\n    } else if (dataBitsValue == 6) {\r\n      dataBits = DataBits.DATA_BITS_6\r\n    } else if (dataBitsValue == 7) {\r\n      dataBits = DataBits.DATA_BITS_7\r\n    } else {\r\n      dataBits = DataBits.DATA_BITS_8\r\n    }\r\n\r\n    let stopBits: StopBits\r\n    if (stopBitsValue == 2) {\r\n      stopBits = StopBits.STOP_BITS_2\r\n    } else {\r\n      stopBits = StopBits.STOP_BITS_1\r\n    }\r\n\r\n    const parity = parseParity(parityValue)\r\n\r\n    // 创建配置对象 - 将 Number 转为 Int\r\n    const serialConfig = SerialConfig(baudRate.toInt(), dataBits, stopBits, parity)\r\n\r\n    // 打开串口\r\n    const serialPort = SerialPort(options.path, serialConfig)\r\n\r\n    // 生成句柄 ID 并保存\r\n    const portId = generatePortId()\r\n    serialPorts.set(portId, serialPort)\r\n\r\n    // 返回成功结果\r\n    const res: OpenResult = {\r\n      errMsg: \"openSerial:ok\",\r\n      portId: portId\r\n    }\r\n    options.success?.(res)\r\n    options.complete?.(res)\r\n\r\n  } catch (e: Exception) {\r\n    const err = new SerialErrorImpl(10001)\r\n    err.errMsg = \"打开串口失败: \" + e.message\r\n    options.fail?.(err)\r\n    options.complete?.(err)\r\n  }\r\n}\r\n\r\n/**\r\n * 写入数据\r\n */\r\nexport function writeSerial(options: WriteOptions) {\r\n  try {\r\n    // 获取串口实例\r\n    const serialPort = serialPorts.get(options.portId.toInt())\r\n    if (serialPort == null) {\r\n      const err = new SerialErrorImpl(10005)\r\n      err.errMsg = \"串口未打开，请先调用 openSerial\"\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 数据格式转换\r\n    const format = options.format ?? 'hex'\r\n    let dataBytes: ByteArray\r\n\r\n    if (format == 'hex') {\r\n      dataBytes = hexToBytes(options.data)\r\n    } else if (format == 'base64') {\r\n      dataBytes = base64ToBytes(options.data)\r\n    } else {\r\n      const err = new SerialErrorImpl(10007)\r\n      err.errMsg = \"不支持的数据格式: \" + format\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 写入数据\r\n    const timeout = options.timeout ?? 1000\r\n    const bytesWritten = serialPort.write(dataBytes, timeout.toInt())\r\n\r\n    // 返回成功结果\r\n    const res: WriteResult = {\r\n      errMsg: \"writeSerial:ok\",\r\n      bytesWritten: bytesWritten\r\n    }\r\n    options.success?.(res)\r\n    options.complete?.(res)\r\n\r\n  } catch (e: Exception) {\r\n    const err = new SerialErrorImpl(10002)\r\n    err.errMsg = \"写入数据失败: \" + e.message\r\n    options.fail?.(err)\r\n    options.complete?.(err)\r\n  }\r\n}\r\n\r\n/**\r\n * 读取数据\r\n */\r\nexport function readSerial(options: ReadOptions) {\r\n  try {\r\n    // 获取串口实例\r\n    const serialPort = serialPorts.get(options.portId.toInt())\r\n    if (serialPort == null) {\r\n      const err = new SerialErrorImpl(10005)\r\n      err.errMsg = \"串口未打开，请先调用 openSerial\"\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 读取数据\r\n    const length = options.length ?? 1024\r\n    const timeout = options.timeout ?? 1000\r\n    const buffer = new ByteArray(length.toInt())\r\n    const bytesRead = serialPort.read(buffer, timeout.toInt())\r\n\r\n    // 数据格式转换\r\n    const format = options.format ?? 'hex'\r\n    let dataStr: string\r\n\r\n    if (format == 'hex') {\r\n      dataStr = bytesToHex(buffer, bytesRead)\r\n    } else if (format == 'base64') {\r\n      dataStr = bytesToBase64(buffer, bytesRead)\r\n    } else {\r\n      const err = new SerialErrorImpl(10007)\r\n      err.errMsg = \"不支持的数据格式: \" + format\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 返回成功结果\r\n    const res: ReadResult = {\r\n      errMsg: \"readSerial:ok\",\r\n      data: dataStr,\r\n      bytesRead: bytesRead\r\n    }\r\n    options.success?.(res)\r\n    options.complete?.(res)\r\n\r\n  } catch (e: Exception) {\r\n    const err = new SerialErrorImpl(10003)\r\n    err.errMsg = \"读取数据失败: \" + e.message\r\n    options.fail?.(err)\r\n    options.complete?.(err)\r\n  }\r\n}\r\n\r\n/**\r\n * 关闭串口\r\n */\r\nexport function closeSerial(options: CloseOptions) {\r\n  try {\r\n    // 获取串口实例\r\n    const serialPort = serialPorts.get(options.portId.toInt())\r\n    if (serialPort == null) {\r\n      const err = new SerialErrorImpl(10005)\r\n      err.errMsg = \"串口未打开\"\r\n      options.fail?.(err)\r\n      options.complete?.(err)\r\n      return\r\n    }\r\n\r\n    // 关闭串口\r\n    serialPort.close()\r\n\r\n    // 从池中移除\r\n    serialPorts.delete(options.portId.toInt())\r\n\r\n    // 返回成功结果\r\n    const res: CloseResult = {\r\n      errMsg: \"closeSerial:ok\"\r\n    }\r\n    options.success?.(res)\r\n    options.complete?.(res)\r\n\r\n  } catch (e: Exception) {\r\n    const err = new SerialErrorImpl(10004)\r\n    err.errMsg = \"关闭串口失败: \" + e.message\r\n    options.fail?.(err)\r\n    options.complete?.(err)\r\n  }\r\n}\r\n\r\n/**\r\n * 列举可用设备\r\n */\r\nexport function listDevices(options?: ListDevicesOptions) {\r\n  try {\r\n    const prefixes = options?.prefixes ?? [\"/dev/ttyS\", \"/dev/ttyUSB\", \"/dev/ttyAMA\"]\r\n    const devices: string[] = []\r\n\r\n    const devDir = File(\"/dev\")\r\n    if (devDir.exists() && devDir.isDirectory()) {\r\n      const files = devDir.listFiles()\r\n      if (files != null) {\r\n        const n: Int = files.size\r\n        for (let i = 0; i < n; i++) {\r\n          const idx: Int = i.toInt()\r\n          const file = files[idx]\r\n          const path = file.getAbsolutePath()\r\n          for (prefix in prefixes) {\r\n            if (path.startsWith(prefix)) {\r\n              devices.push(path)\r\n              break\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // 返回成功结果\r\n    const res: ListDevicesResult = {\r\n      errMsg: \"listDevices:ok\",\r\n      devices: devices\r\n    }\r\n    options?.success?.(res)\r\n    options?.complete?.(res)\r\n\r\n  } catch (e: Exception) {\r\n    const err = new SerialErrorImpl(10006)\r\n    err.errMsg = \"列举设备失败: \" + e.message\r\n    options?.fail?.(err)\r\n    options?.complete?.(err)\r\n  }\r\n}\r\n\r\n/**\r\n * 获取插件版本\r\n */\r\nexport function getVersion(): string {\r\n  return \"1.0.0\"\r\n}\r\n"]}