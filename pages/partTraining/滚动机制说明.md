<!-- markdownlint-disable -->
# 部位训练页面滚动机制说明

## 需求目标

实现一个固定布局的页面，页面本身不可滚动，但内部的课程列表区域可以独立滚动。

## 页面结构

```
page (固定高度，禁止滚动)
├── header (固定高度)
└── content (flex: 1，填充剩余空间)
    ├── sidebar (固定宽度，内部可滚动)
    └── main-column (flex: 1)
        ├── search-bar (固定高度)
        └── course-scroll (flex: 1，可滚动)
            └── course-grid (内容区域)
```

## 配置层级

### 1. 全局配置 (App.vue)

```css
page {
  background-color: #F5F5F5;
  height: 100% !important;
  overflow: hidden !important;
}
```

作用：全局禁用页面原生滚动

### 2. 页面配置 (pages.json)

```json
{
  "path": "pages/partTraining/part-training",
  "style": {
    "navigationBarTitleText": "",
    "navigationStyle": "custom",
    "disableScroll": true,
    "bounce": "none"
  }
}
```

关键配置：
- `disableScroll: true` - 禁用页面原生滚动
- `bounce: "none"` - 禁用回弹效果

### 3. 页面样式 (part-training.vue)

#### 页面级全局样式（非 scoped）

```css
page {
  height: 100% !important;
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
}
```

作用：确保当前页面的滚动被完全锁定

#### 组件级样式（scoped）

核心布局样式：

```scss
.page {
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.header {
  height: 96rpx;
  flex-shrink: 0;  // 固定高度，不参与伸缩
}

.content {
  flex: 1;         // 占满剩余空间
  display: flex;
  overflow: hidden;
}

.main-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;   // 关键：允许子元素正确计算高度
}

.search-bar {
  flex-shrink: 0;  // 固定高度
}

.course-scroll {
  flex: 1;         // 占满剩余空间
  min-height: 0;   // 关键：配合 flex 正确计算高度
}
```

#### 模板中的 scroll-view 配置

```html
<scroll-view
  class="course-scroll"
  scroll-y="true"
  :show-scrollbar="false"
>
```

关键属性：
- `scroll-y="true"` - 启用纵向滚动（必须是字符串 "true" 或布尔值 true）
- `:show-scrollbar="false"` - 隐藏滚动条

## 关键技术点

### 1. Flexbox 高度计算

当使用 `flex: 1` 让子元素填充剩余空间时，需要在父容器上设置 `min-height: 0`，否则某些情况下子元素高度会被内容撑开而不是被限制在父容器内。

示例：
```scss
.main-column {
  flex: 1;
  min-height: 0;  // 必须
}

.course-scroll {
  flex: 1;
  min-height: 0;  // 必须
}
```

### 2. scroll-view 触发滚动的条件

scroll-view 组件需要满足以下条件才能触发滚动：

1. 必须有明确的高度限制（通过 flex 或固定高度）
2. 内容高度必须超出容器高度
3. 设置 `scroll-y="true"` 或 `scroll-x="true"`

### 3. !important 的使用

在全局样式中使用 `!important` 确保优先级最高，防止被其他样式覆盖。但在组件内部样式中避免过度使用 `!important`，以免后续难以覆盖。

当前配置：
- 全局 page 样式使用 `!important`（必要）
- 组件内部样式避免使用 `!important`（推荐）

## 常见问题排查

### 问题1：页面可以滚动，但课程列表不能滚动

原因：缺少以下任一配置
- pages.json 中缺少 `disableScroll: true`
- 页面级 page 样式缺少 `overflow: hidden`

解决：检查配置层级是否完整

### 问题2：整个页面都不能滚动，课程列表也不能滚动

原因：scroll-view 没有获得正确的高度限制

解决：
- 检查父容器是否有 `min-height: 0`
- 检查 scroll-view 是否有 `flex: 1` 和 `min-height: 0`
- 检查 `scroll-y` 属性是否设置

### 问题3：scroll-view 高度计算不正确

原因：flex 布局链条中断

解决：从顶层到 scroll-view 的每一层都要正确设置 flex 属性
```
.page (height: 100vh, flex column)
  └── .content (flex: 1, flex row)
      └── .main-column (flex: 1, flex column, min-height: 0)
          └── .course-scroll (flex: 1, min-height: 0)
```

## 调试建议

1. 使用开发者工具检查元素实际高度
2. 临时给 scroll-view 添加背景色，确认其尺寸是否正确
3. 检查 scroll-view 内容高度是否超出容器高度
4. 查看控制台是否有警告信息

## 参考示例

当前部位训练页面的滚动配置已经过验证可用，可作为标准模板应用到其他类似场景。

核心要点：
- 三层配置：App.vue -> pages.json -> 页面组件
- Flexbox 布局链：每层都要正确设置 flex 和 min-height
- scroll-view 配置：scroll-y="true" + flex: 1 + min-height: 0
